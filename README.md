# QuantMARLGA

**Multi-Agent Reinforcement Learning with Genetic Algorithm for Quantitative Trading**

RACE ë…¼ë¬¸ ê¸°ë°˜ GA+MARL í•˜ì´ë¸Œë¦¬ë“œ í•œêµ­ ì£¼ì‹ íŠ¸ë ˆì´ë”© ì‹œìŠ¤í…œ

---

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

### í•µì‹¬ ì•„ì´ë””ì–´
- **4ê°œ ì „ë¬¸í™” ì—ì´ì „íŠ¸**: Value, Quality, Portfolio, Hedging
- **ë³‘ë ¬ + ìœµí•© êµ¬ì¡°**: Value/Quality ë³‘ë ¬ â†’ Portfolio â†’ Hedging ìˆœì°¨
- **RACE ë°©ì‹ í•™ìŠµ**: EA Population (GA ì§„í™”) + MARL íŒ€ (RL í•™ìŠµ)
- **ì‹¤ì „ ë°ì´í„°**: í•œêµ­ ì£¼ì‹ ì‹œì¥ ì‹¤ì œ ë°ì´í„° (KOSPI ìƒìœ„ ì¢…ëª©)

# QuantMARLGA ì‹œìŠ¤í…œ êµ¬ì¡° ì‹œê°í™” (ìµœì‹  êµ¬í˜„ ê¸°ì¤€)

**Multi-Agent Reinforcement Learning + Genetic Algorithm for Trading**

---

## ğŸ—ï¸ 1. ì „ì²´ ì•„í‚¤í…ì²˜ (High-Level)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GA-MARL HYBRID SYSTEM                             â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚               GA POPULATION (10ê°œ EA ì‹œìŠ¤í…œ)                â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚  â”‚  â”‚System #1 â”‚  â”‚System #2 â”‚   ...   â”‚System #10â”‚          â”‚    â”‚
â”‚  â”‚  â”‚fitness:  â”‚  â”‚fitness:  â”‚         â”‚fitness:  â”‚          â”‚    â”‚
â”‚  â”‚  â”‚  0.742   â”‚  â”‚  1.196   â”‚         â”‚  1.725 â˜… â”‚          â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  ê° System = 4ê°œ Agent (Value, Quality, Portfolio, Hedging) â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  MARL TEAM (1ê°œ, ì˜êµ¬ ë³´ì¡´)                 â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚    â”‚
â”‚  â”‚  â”‚MARL Team â”‚  â† RL í•™ìŠµ (Shared Buffer í™œìš©)              â”‚    â”‚
â”‚  â”‚  â”‚fitness:  â”‚  â† ë§¤ ì„¸ëŒ€ ë³µì‚¬ë³¸ì„ Populationì— ì£¼ì…        â”‚    â”‚
â”‚  â”‚  â”‚ -0.844   â”‚  â† ì›ë³¸ì€ ì ˆëŒ€ ëŒ€ì²´ ì•ˆ ë¨                    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚          SHARED REPLAY BUFFER (capacity=10,000)             â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  â€¢ ëª¨ë“  ì‹œìŠ¤í…œ(EA + MARL)ì˜ ê²½í—˜ ì €ì¥                       â”‚    â”‚
â”‚  â”‚  â€¢ MARL íŒ€ì´ ì „ì²´ ë²„í¼ì—ì„œ ìƒ˜í”Œë§í•˜ì—¬ í•™ìŠµ                 â”‚    â”‚
â”‚  â”‚  â€¢ ê³µìœ  ì¸ì½”ë” í•™ìŠµì— ëª¨ë“  ê²½í—˜ í™œìš©                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         GLOBAL SHARED ENCODERS (íƒ€ì…ë³„ ê³µìœ )                â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  â”œâ”€ value_encoder: SharedEncoder(63, 128)                  â”‚    â”‚
â”‚  â”‚  â”œâ”€ quality_encoder: SharedEncoder(63, 128)                â”‚    â”‚
â”‚  â”‚  â”œâ”€ portfolio_encoder: SharedEncoder(156, 128)             â”‚    â”‚
â”‚  â”‚  â””â”€ hedging_encoder: SharedEncoder(122, 128)               â”‚    â”‚
â”‚  â”‚                                                              â”‚    â”‚
â”‚  â”‚  â€¢ 11ê°œ ì‹œìŠ¤í…œì˜ ê°™ì€ íƒ€ì… ì—ì´ì „íŠ¸ê°€ ì¸ì½”ë” ê³µìœ            â”‚    â”‚
â”‚  â”‚  â€¢ MARLë§Œ ì¸ì½”ë” ì—…ë°ì´íŠ¸, EAëŠ” í™œìš© (Selective Learning)  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ 2. í•™ìŠµ ë£¨í”„ (GA-MARL Hybrid Training)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GENERATION LOOP (12 ì„¸ëŒ€)                        â”‚
â”‚                     Rolling Window: 2021-2023                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                      â”‚
        â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“  â”‚
        â”‚  â”ƒ  PHASE 1: Rollout + Fitness í‰ê°€            â”ƒ  â”‚
        â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›  â”‚
        â”‚                                                      â”‚
        â”‚  for each system in [EA #1~#10 + MARL]:            â”‚
        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
        â”‚    â”‚ ë°±í…ŒìŠ¤íŠ¸ (3ê°œì›”, ì•½ 60ê±°ë˜ì¼)        â”‚        â”‚
        â”‚    â”‚                                      â”‚        â”‚
        â”‚    â”‚  Day 1: market_state                 â”‚        â”‚
        â”‚    â”‚    â†’ Value & Quality (ë³‘ë ¬)          â”‚        â”‚
        â”‚    â”‚    â†’ Portfolio (ìœµí•©)                â”‚        â”‚
        â”‚    â”‚    â†’ Hedging (ìˆœì°¨)                  â”‚        â”‚
        â”‚    â”‚    â†’ trade execution                 â”‚        â”‚
        â”‚    â”‚    â†’ store transition (Shared Buffer)â”‚        â”‚
        â”‚    â”‚                                      â”‚        â”‚
        â”‚    â”‚  Day 2~60: ...                       â”‚        â”‚
        â”‚    â”‚                                      â”‚        â”‚
        â”‚    â”‚  Calculate:                          â”‚        â”‚
        â”‚    â”‚  - period_return (ê¸°ê°„ìˆ˜ìµë¥ )        â”‚        â”‚
        â”‚    â”‚  - sharpe_ratio                      â”‚        â”‚
        â”‚    â”‚  - max_drawdown                      â”‚        â”‚
        â”‚    â”‚  â†’ fitness = sharpe_ratio            â”‚        â”‚
        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
        â”‚                                                      â”‚
        â”‚  Result:                                            â”‚
        â”‚  - EA fitness: [fâ‚, fâ‚‚, ..., fâ‚â‚€]                  â”‚
        â”‚  - MARL fitness: f_marl                             â”‚
        â”‚  - Shared Buffer: ~660ê°œ ê²½í—˜ ì¶”ê°€                  â”‚
        â”‚                                                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                      â”‚
        â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“  â”‚
        â”‚  â”ƒ  PHASE 2: RL Learning (MARL íŒ€ë§Œ)           â”ƒ  â”‚
        â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›  â”‚
        â”‚                                                      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚  â”‚ for _ in range(200):  # 200íšŒ RL ì—…ë°ì´íŠ¸ â”‚    â”‚
        â”‚  â”‚   # 50â†’200: RACE-proportional           â”‚    â”‚
        â”‚  â”‚                                            â”‚    â”‚
        â”‚  â”‚   batch = shared_buffer.sample(64)        â”‚    â”‚
        â”‚  â”‚   # ì „ì²´ ë²„í¼(~7000)ì—ì„œ ìƒ˜í”Œë§           â”‚    â”‚
        â”‚  â”‚   # EA + MARL ëª¨ë“  ê²½í—˜ í™œìš©!             â”‚    â”‚
        â”‚  â”‚                                            â”‚    â”‚
        â”‚  â”‚   # Encoder í•™ìŠµ (Global Optimizer)       â”‚    â”‚
        â”‚  â”‚   for agent_type in [v,q,p,h]:            â”‚    â”‚
        â”‚  â”‚     encoder_loss = actor + critic_loss    â”‚    â”‚
        â”‚  â”‚     global_optimizer.step()               â”‚    â”‚
        â”‚  â”‚                                            â”‚    â”‚
        â”‚  â”‚   # Head í•™ìŠµ (Local Optimizer)           â”‚    â”‚
        â”‚  â”‚   for agent in marl_agents:               â”‚    â”‚
        â”‚  â”‚     actor_head.update()                   â”‚    â”‚
        â”‚  â”‚     critic_head.update()                  â”‚    â”‚
        â”‚  â”‚                                            â”‚    â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â”‚                                                      â”‚
        â”‚  Result:                                            â”‚
        â”‚  - ê³µìœ  ì¸ì½”ë”: 11ê°œ ì‹œìŠ¤í…œ ê²½í—˜ìœ¼ë¡œ í•™ìŠµ           â”‚
        â”‚  - MARL í—¤ë“œ: ì—…ë°ì´íŠ¸ë¨                            â”‚
        â”‚  - EA ì‹œìŠ¤í…œ: ë³€í™” ì—†ìŒ (GAë§Œ ì§„í™”)                 â”‚
        â”‚                                                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                      â”‚
        â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“  â”‚
        â”‚  â”ƒ  PHASE 3: Injection (ì¡°ê±´ë¶€)                â”ƒ  â”‚
        â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›  â”‚
        â”‚                                                      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚  â”‚ worst_idx = argmin(ea_fitness)            â”‚    â”‚
        â”‚  â”‚ # EA #4: fitness = -0.4226                â”‚    â”‚
        â”‚  â”‚                                            â”‚    â”‚
        â”‚  â”‚ if marl_fitness > ea_fitness[worst_idx]:  â”‚    â”‚
        â”‚  â”‚   population[worst_idx] = marl.clone()    â”‚    â”‚
        â”‚  â”‚   print("[OK] Injection ì™„ë£Œ")             â”‚    â”‚
        â”‚  â”‚ else:                                      â”‚    â”‚
        â”‚  â”‚   print("[SKIP] MARLì´ ë” ë‚®ìŒ")           â”‚    â”‚
        â”‚  â”‚                                            â”‚    â”‚
        â”‚  â”‚ âš ï¸ MARL ì›ë³¸ì€ ì ˆëŒ€ ëŒ€ì²´ ì•ˆ ë¨!            â”‚    â”‚
        â”‚  â”‚    (marl_teamì€ ì˜êµ¬ ë³´ì¡´)                â”‚    â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â”‚                                                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                      â”‚
        â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“  â”‚
        â”‚  â”ƒ  PHASE 4: GA Evolution                      â”ƒ  â”‚
        â”‚  â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›  â”‚
        â”‚                                                      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚  â”‚ Step 4-1: Elitism                         â”‚    â”‚
        â”‚  â”‚                                            â”‚    â”‚
        â”‚  â”‚  elite_indices = top_3_fitness            â”‚    â”‚
        â”‚  â”‚  # ìƒìœ„ 30% ë³´ì¡´                          â”‚    â”‚
        â”‚  â”‚  new_population = [elite_1, elite_2, ...] â”‚    â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â”‚                                                      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚  â”‚ Step 4-2: Tournament Selection            â”‚    â”‚
        â”‚  â”‚                                            â”‚    â”‚
        â”‚  â”‚  for child in range(7):  # 7ê°œ ìì‹ ìƒì„±  â”‚    â”‚
        â”‚  â”‚    parent1 = tournament_select(k=3)       â”‚    â”‚
        â”‚  â”‚    parent2 = tournament_select(k=3)       â”‚    â”‚
        â”‚  â”‚                                            â”‚    â”‚
        â”‚  â”‚    # Crossover (Agent-level)              â”‚    â”‚
        â”‚  â”‚    child = crossover(parent1, parent2)    â”‚    â”‚
        â”‚  â”‚    # Value(p1) + Quality(p1) +            â”‚    â”‚
        â”‚  â”‚    # Portfolio(p2) + Hedging(p2)          â”‚    â”‚
        â”‚  â”‚                                            â”‚    â”‚
        â”‚  â”‚    # Sparse Mutation (RACE ìŠ¤íƒ€ì¼)        â”‚    â”‚
        â”‚  â”‚    if random() < 0.9:  # 90% ìì‹ ë³€ì´    â”‚    â”‚
        â”‚  â”‚      mutate_head(child, prob=0.1)         â”‚    â”‚
        â”‚  â”‚      # í—¤ë“œë§Œ ë³€ì´ (ì¸ì½”ë”ëŠ” RL í•™ìŠµ)     â”‚    â”‚
        â”‚  â”‚      # íŒŒë¼ë¯¸í„° 10%ë§Œ ë³€ì´ (Sparse!)      â”‚    â”‚
        â”‚  â”‚                                            â”‚    â”‚
        â”‚  â”‚    new_population.append(child)           â”‚    â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â”‚                                                      â”‚
        â”‚  Result: population = [3 elite + 7 children]       â”‚
        â”‚                                                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚  â”‚ Generation í†µê³„ (ì§„í™” ì „ ì¶œë ¥)            â”‚    â”‚
        â”‚  â”‚                                            â”‚    â”‚
        â”‚  â”‚ ìµœê³  Fitness: 1.7250                      â”‚    â”‚
        â”‚  â”‚ í‰ê·  Fitness: 0.5340                      â”‚    â”‚
        â”‚  â”‚ ìµœì € Fitness: -0.4226                     â”‚    â”‚
        â”‚  â”‚ ì—­ëŒ€ ìµœê³ : 3.8485                         â”‚    â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â”‚                                                      â”‚
        â”‚  population = new_population                        â”‚
        â”‚  generation += 1                                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ (loop back)
                              â–¼
```

---

## ğŸ¤– 3. MultiAgentSystem ë‚´ë¶€ êµ¬ì¡° (ê³µìœ  ì¸ì½”ë” + ë…ë¦½ í—¤ë“œ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MultiAgentSystem                                â”‚
â”‚                     (ë‹¨ì¼ íŠ¸ë ˆì´ë”© ì‹œìŠ¤í…œ)                             â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                GLOBAL SHARED ENCODERS                        â”‚   â”‚
â”‚  â”‚            (ëª¨ë“  ì‹œìŠ¤í…œì´ íƒ€ì…ë³„ë¡œ ê³µìœ )                     â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  value_encoder â”€â”€â”€â”€â”  quality_encoder â”€â”€â”                   â”‚   â”‚
â”‚  â”‚  (63 â†’ 128)        â”‚  (63 â†’ 128)        â”‚                   â”‚   â”‚
â”‚  â”‚                    â”‚                    â”‚                   â”‚   â”‚
â”‚  â”‚  portfolio_encoderâ”€â”¤  hedging_encoder â”€â”€â”¤                  â”‚   â”‚
â”‚  â”‚  (156 â†’ 128)       â”‚  (122 â†’ 128)       â”‚                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â”‚                    â”‚                        â”‚
â”‚                       â–¼                    â–¼                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚          4-Agent Pipeline (ë³‘ë ¬ + ìœµí•© êµ¬ì¡°)                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  Market State (30 stocks Ã— features)                                 â”‚
â”‚        â”‚                                                              â”‚
â”‚        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚        â”‚                     â”‚                        â”‚             â”‚
â”‚        â–¼ (ë³‘ë ¬)              â–¼ (ë³‘ë ¬)                 â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚             â”‚
â”‚  â”‚  Value Agent     â”‚  â”‚  Quality Agent   â”‚         â”‚             â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚         â”‚             â”‚
â”‚  â”‚ Input (63):      â”‚  â”‚ Input (63):      â”‚         â”‚             â”‚
â”‚  â”‚ - PER ratios(30) â”‚  â”‚ - ROE ratios(30) â”‚         â”‚             â”‚
â”‚  â”‚ - PBR ratios(30) â”‚  â”‚ - Debt ratio(30) â”‚         â”‚             â”‚
â”‚  â”‚ - Market PER(1)  â”‚  â”‚ - Market ROE(1)  â”‚         â”‚             â”‚
â”‚  â”‚ - Market PBR(1)  â”‚  â”‚ - Market Debt(1) â”‚         â”‚             â”‚
â”‚  â”‚ - Sector info(1) â”‚  â”‚ - Sector info(1) â”‚         â”‚             â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚         â”‚             â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚             â”‚
â”‚  â”‚ â”‚value_encoder â”‚ â”‚  â”‚ â”‚quality_encdr â”‚ â”‚         â”‚             â”‚
â”‚  â”‚ â”‚(63 â†’ 128)    â”‚ â”‚  â”‚ â”‚(63 â†’ 128)    â”‚ â”‚         â”‚             â”‚
â”‚  â”‚ â”‚  [ê³µìœ ]      â”‚ â”‚  â”‚ â”‚  [ê³µìœ ]      â”‚ â”‚         â”‚             â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚             â”‚
â”‚  â”‚        â–¼         â”‚  â”‚        â–¼         â”‚         â”‚             â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚             â”‚
â”‚  â”‚ â”‚actor_head    â”‚ â”‚  â”‚ â”‚actor_head    â”‚ â”‚         â”‚             â”‚
â”‚  â”‚ â”‚(128 â†’ 30)    â”‚ â”‚  â”‚ â”‚(128 â†’ 30)    â”‚ â”‚         â”‚             â”‚
â”‚  â”‚ â”‚  [ë…ë¦½]      â”‚ â”‚  â”‚ â”‚  [ë…ë¦½]      â”‚ â”‚         â”‚             â”‚
â”‚  â”‚ â”‚  Sigmoid     â”‚ â”‚  â”‚ â”‚  Sigmoid     â”‚ â”‚         â”‚             â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚             â”‚
â”‚           â”‚                     â”‚                    â”‚             â”‚
â”‚           â”‚ value_scores(30)    â”‚ quality_scores(30) â”‚             â”‚
â”‚           â”‚ [0.7, 0.3, ...]     â”‚ [0.8, 0.5, ...]    â”‚             â”‚
â”‚           â”‚                     â”‚                    â”‚             â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚             â”‚
â”‚                      â”‚                               â”‚             â”‚
â”‚                      â–¼ (ìœµí•©)                        â”‚             â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚             â”‚
â”‚              â”‚ Portfolio Agent   â”‚                   â”‚             â”‚
â”‚              â”‚                   â”‚                   â”‚             â”‚
â”‚              â”‚ Input (156):      â”‚                   â”‚             â”‚
â”‚              â”‚ - value_scores(30)â”‚                   â”‚             â”‚
â”‚              â”‚ - quality_scores(30)                  â”‚             â”‚
â”‚              â”‚ - risk_metrics(30)â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚             â”‚
â”‚              â”‚ - historical(30)  â”‚   â”‚price changesâ”‚ â”‚             â”‚
â”‚              â”‚ - portfolio_val(1)â”‚   â”‚volatility   â”‚ â”‚             â”‚
â”‚              â”‚ - cash_ratio(1)   â”‚   â”‚beta, sharpe â”‚ â”‚             â”‚
â”‚              â”‚ - current_pos(30) â”‚   â”‚VaR, MDD     â”‚ â”‚             â”‚
â”‚              â”‚ - market_risk(4)  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚             â”‚
â”‚              â”‚                   â”‚                   â”‚             â”‚
â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                   â”‚             â”‚
â”‚              â”‚ â”‚portfolio_enc  â”‚ â”‚                   â”‚             â”‚
â”‚              â”‚ â”‚(156 â†’ 128)    â”‚ â”‚                   â”‚             â”‚
â”‚              â”‚ â”‚  [ê³µìœ ]       â”‚ â”‚                   â”‚             â”‚
â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                   â”‚             â”‚
â”‚              â”‚         â–¼         â”‚                   â”‚             â”‚
â”‚              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                   â”‚             â”‚
â”‚              â”‚ â”‚actor_head     â”‚ â”‚                   â”‚             â”‚
â”‚              â”‚ â”‚(128 â†’ 30)     â”‚ â”‚                   â”‚             â”‚
â”‚              â”‚ â”‚  [ë…ë¦½]       â”‚ â”‚                   â”‚             â”‚
â”‚              â”‚ â”‚  Softmax      â”‚ â”‚                   â”‚             â”‚
â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                   â”‚             â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚             â”‚
â”‚                         â”‚                            â”‚             â”‚
â”‚                         â”‚ portfolio_weights(30)      â”‚             â”‚
â”‚                         â”‚ [0.08, 0.12, ...]          â”‚             â”‚
â”‚                         â”‚ (sum=1.0)                  â”‚             â”‚
â”‚                         â”‚                            â”‚             â”‚
â”‚                         â–¼                            â”‚             â”‚
â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚             â”‚
â”‚                 â”‚  Hedging Agent    â”‚                â”‚             â”‚
â”‚                 â”‚                   â”‚                â”‚             â”‚
â”‚                 â”‚ Input (122):      â”‚                â”‚             â”‚
â”‚                 â”‚ - portfolio_wts(30)                â”‚             â”‚
â”‚                 â”‚ - current_pos(30) â”‚                â”‚             â”‚
â”‚                 â”‚ - risk_metrics(30)â”‚                â”‚             â”‚
â”‚                 â”‚ - market_risk(30) â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚             â”‚
â”‚                 â”‚ - VIX(1)          â”‚  â”‚price vol â”‚ â”‚             â”‚
â”‚                 â”‚ - interest(1)     â”‚  â”‚KOSPI vol â”‚ â”‚             â”‚
â”‚                 â”‚                   â”‚  â”‚sector volâ”‚ â”‚             â”‚
â”‚                 â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚             â”‚
â”‚                 â”‚ â”‚hedging_encoderâ”‚ â”‚                â”‚             â”‚
â”‚                 â”‚ â”‚(122 â†’ 128)    â”‚ â”‚                â”‚             â”‚
â”‚                 â”‚ â”‚  [ê³µìœ ]       â”‚ â”‚                â”‚             â”‚
â”‚                 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                â”‚             â”‚
â”‚                 â”‚         â–¼         â”‚                â”‚             â”‚
â”‚                 â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                â”‚             â”‚
â”‚                 â”‚ â”‚actor_head     â”‚ â”‚                â”‚             â”‚
â”‚                 â”‚ â”‚(128 â†’ 30)     â”‚ â”‚                â”‚             â”‚
â”‚                 â”‚ â”‚  [ë…ë¦½]       â”‚ â”‚                â”‚             â”‚
â”‚                 â”‚ â”‚  Sigmoid      â”‚ â”‚                â”‚             â”‚
â”‚                 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                â”‚             â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚             â”‚
â”‚                            â”‚                         â”‚             â”‚
â”‚                            â”‚ hedge_ratios(30)        â”‚             â”‚
â”‚                            â”‚ [0.6, 0.7, ...] (0~1)   â”‚             â”‚
â”‚                            â–¼                         â”‚             â”‚
â”‚  Final Position = portfolio_weights Ã— (1 - hedge_ratios)          â”‚
â”‚  â†’ [0.032, 0.036, ...] (ì‹¤ì œ ë§¤ë§¤ ë¹„ì¤‘)                            â”‚
â”‚                                                                       â”‚
â”‚  Fitness: 0.742 (Sharpe Ratio)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§  4. ë‹¨ì¼ Agent ë‚´ë¶€ êµ¬ì¡° (ê³µìœ  ì¸ì½”ë” + ë…ë¦½ í—¤ë“œ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Value Agent (ì˜ˆì‹œ)                             â”‚
â”‚             ê³µìœ  ì¸ì½”ë” + ë…ë¦½ í—¤ë“œ êµ¬ì¡°                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                           â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚      FORWARD PASS (act)             â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                           â”‚
        â”‚  Input: obs (63,)                         â”‚
        â”‚    [PER_ratios(30), PBR_ratios(30), ...]  â”‚
        â”‚         â”‚                                 â”‚
        â”‚         â–¼                                 â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
        â”‚  â”‚ value_encoder   â”‚ â† ì „ì—­ ê³µìœ !         â”‚
        â”‚  â”‚                 â”‚   (11ê°œ ì‹œìŠ¤í…œ)      â”‚
        â”‚  â”‚  Linear(63â†’128) â”‚                     â”‚
        â”‚  â”‚  ReLU           â”‚                     â”‚
        â”‚  â”‚  Linear(128â†’128)â”‚                     â”‚
        â”‚  â”‚  ReLU           â”‚                     â”‚
        â”‚  â”‚                 â”‚                     â”‚
        â”‚  â”‚  [Orthogonal    â”‚                     â”‚
        â”‚  â”‚   initialized]  â”‚                     â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
        â”‚         â”‚                                 â”‚
        â”‚         â–¼ features (128,)                 â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
        â”‚  â”‚  actor_head     â”‚ â† ì‹œìŠ¤í…œë³„ ë…ë¦½!     â”‚
        â”‚  â”‚                 â”‚                     â”‚
        â”‚  â”‚  Linear(128â†’30) â”‚                     â”‚
        â”‚  â”‚  Sigmoid        â”‚                     â”‚
        â”‚  â”‚                 â”‚                     â”‚
        â”‚  â”‚  [Orthogonal    â”‚                     â”‚
        â”‚  â”‚   init, gain=0.01]                    â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
        â”‚         â”‚                                 â”‚
        â”‚         â–¼                                 â”‚
        â”‚  Output: value_scores (30,)               â”‚
        â”‚    [0.7, 0.3, 0.6, 0.8, ...]             â”‚
        â”‚                                           â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚      TRAINING (update) - MARLë§Œ     â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                           â”‚
        â”‚  Input: batch from Shared Buffer          â”‚
        â”‚  # 660ê°œ ê²½í—˜ (EA 600 + MARL 60)         â”‚
        â”‚                                           â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚  Encoder Update (Global Optimizer)  â”‚ â”‚
        â”‚  â”‚                                     â”‚ â”‚
         â”‚  â”‚  encoder_loss = actor + critic_loss â”‚ â”‚
         â”‚  â”‚                                     â”‚ â”‚
         â”‚  â”‚  global_encoders.value_optimizer    â”‚ â”‚
         â”‚  â”‚    .zero_grad()  # LR=3e-4         â”‚ â”‚
         â”‚  â”‚  encoder_loss.backward()            â”‚ â”‚
         â”‚  â”‚  global_encoders.value_optimizer    â”‚ â”‚
         â”‚  â”‚    .step()                          â”‚ â”‚
        â”‚  â”‚                                     â”‚ â”‚
        â”‚  â”‚  âš ï¸ 11ê°œ ì‹œìŠ¤í…œ ê²½í—˜ìœ¼ë¡œ í•™ìŠµ!       â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                           â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚  Head Update (Local Optimizer)      â”‚ â”‚
        â”‚  â”‚                                     â”‚ â”‚
         â”‚  â”‚  # Critic Head (LR=5e-4)            â”‚ â”‚
         â”‚  â”‚  current_values = critic_head(feat) â”‚ â”‚
         â”‚  â”‚  target_values = critic_target(...)  â”‚ â”‚
         â”‚  â”‚  td_target = r + Î³Â·target_values    â”‚ â”‚
         â”‚  â”‚  advantages = td_target - current... â”‚ â”‚
         â”‚  â”‚  critic_loss = MSE(...)             â”‚ â”‚
         â”‚  â”‚                                     â”‚ â”‚
         â”‚  â”‚  critic_optimizer.zero_grad()       â”‚ â”‚
         â”‚  â”‚  critic_loss.backward()             â”‚ â”‚
         â”‚  â”‚  clip_grad_norm_(params, 10.0)      â”‚ â”‚
         â”‚  â”‚  critic_optimizer.step()            â”‚ â”‚
        â”‚  â”‚                                     â”‚ â”‚
         â”‚  â”‚  # Actor Head (LR=3e-4)             â”‚ â”‚
         â”‚  â”‚  actor_loss = -advantages * log_probâ”‚ â”‚
         â”‚  â”‚                                     â”‚ â”‚
         â”‚  â”‚  actor_optimizer.zero_grad()        â”‚ â”‚
         â”‚  â”‚  actor_loss.backward()              â”‚ â”‚
         â”‚  â”‚  clip_grad_norm_(params, 10.0)      â”‚ â”‚
         â”‚  â”‚  actor_optimizer.step()             â”‚ â”‚
        â”‚  â”‚                                     â”‚ â”‚
        â”‚  â”‚  # Target Update (soft)             â”‚ â”‚
        â”‚  â”‚  critic_target â† Ï„Â·critic + (1-Ï„)Â·..â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                           â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚      MUTATION (GA) - EAë§Œ           â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                                           â”‚
        â”‚  if random() < 0.9:  # 90% ìì‹ ë³€ì´     â”‚
        â”‚    for param in actor_head.parameters(): â”‚
        â”‚      if random() < 0.1:  # 10% íŒŒë¼ë¯¸í„°  â”‚
        â”‚        param += randn() * 0.05 * param  â”‚
        â”‚                                           â”‚
        â”‚    for param in critic_head.parameters():â”‚
        â”‚      if random() < 0.1:                  â”‚
        â”‚        param += randn() * 0.05 * param  â”‚
        â”‚                                           â”‚
        â”‚  âš ï¸ í—¤ë“œë§Œ ë³€ì´ (ì¸ì½”ë”ëŠ” RLë¡œ í•™ìŠµ)      â”‚
        â”‚  âš ï¸ Sparse Mutation (ì‹¤ì œ ë³€ì´ìœ¨ 9%)     â”‚
        â”‚                                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š 5. ë°ì´í„° íë¦„ (Shared Buffer + Selective Learning)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DATA FLOW WITH SHARED ENCODER                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: ì „ì²´ ì‹œìŠ¤í…œ Rollout
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  EA #1~#10 (ê° 60ì¼) + MARL (60ì¼)
        â”‚
        â”œâ”€ ê° ì‹œìŠ¤í…œì´ 60ê°œ transition ìƒì„±
        â”‚  (4ê°œ ì—ì´ì „íŠ¸ Ã— 60ì¼ = 240ê°œ ê²½í—˜/ì‹œìŠ¤í…œ)
        â”‚
        â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚       Shared Replay Buffer                  â”‚
  â”‚                                             â”‚
  â”‚  EA #1:  [tâ‚€, tâ‚, ..., tâ‚…â‚‰]  (60ê°œ)        â”‚
  â”‚  EA #2:  [tâ‚€, tâ‚, ..., tâ‚…â‚‰]  (60ê°œ)        â”‚
  â”‚  ...                                        â”‚
  â”‚  EA #10: [tâ‚€, tâ‚, ..., tâ‚…â‚‰]  (60ê°œ)        â”‚
  â”‚  MARL:   [tâ‚€, tâ‚, ..., tâ‚…â‚‰]  (60ê°œ)        â”‚
  â”‚                                             â”‚
  â”‚  Total: 660ê°œ transition                   â”‚
  â”‚  ê° transitionì€ 4ê°œ ì—ì´ì „íŠ¸ ë°ì´í„° í¬í•¨  â”‚
  â”‚  â†’ ì‹¤ì§ˆì ìœ¼ë¡œ 2640ê°œ ê²½í—˜!                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚  buffer.sample(256)
        â–¼


Step 2: MARL í•™ìŠµ (Selective Encoder Learning)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  MARL Team Update (200íšŒ)                  â”‚
  â”‚  # 50â†’200: ì¶©ë¶„í•œ í•™ìŠµ ë³´ì¥               â”‚
  â”‚                                             â”‚
  â”‚  for _ in range(200):                      â”‚
  â”‚                                             â”‚
  â”‚    batch = buffer.sample(64)               â”‚
  â”‚    # ì „ì²´ 660ê°œ ì¤‘ ëœë¤ ìƒ˜í”Œë§              â”‚
  â”‚    # EA ê²½í—˜(600) + MARL ê²½í—˜(60) ì„ì„!   â”‚
  â”‚                                             â”‚
  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚    â”‚ Value Agent Update                  â”‚ â”‚
  â”‚    â”‚                                     â”‚ â”‚
  â”‚    â”‚ features = value_encoder(obs)      â”‚ â”‚
  â”‚    â”‚ â†“ [ê³µìœ  ì¸ì½”ë” ì‚¬ìš©]                â”‚ â”‚
  â”‚    â”‚                                     â”‚ â”‚
  â”‚    â”‚ actions = actor_head(features)     â”‚ â”‚
  â”‚    â”‚ values = critic_head(features)     â”‚ â”‚
  â”‚    â”‚                                     â”‚ â”‚
  â”‚    â”‚ # Encoder í•™ìŠµ (Global Optimizer)  â”‚ â”‚
  â”‚    â”‚ encoder_loss = actor + critic_loss â”‚ â”‚
  â”‚    â”‚ global_encoders.value_optimizer    â”‚ â”‚
  â”‚    â”‚   .step()                          â”‚ â”‚
  â”‚    â”‚ â†‘ [256ê°œ ë°°ì¹˜ë¡œ ì¸ì½”ë” ì—…ë°ì´íŠ¸]    â”‚ â”‚
  â”‚    â”‚ â†‘ [EA + MARL ê²½í—˜ ëª¨ë‘ í™œìš©!]      â”‚ â”‚
  â”‚    â”‚                                     â”‚ â”‚
  â”‚    â”‚ # Head í•™ìŠµ (Local Optimizer)      â”‚ â”‚
  â”‚    â”‚ actor_optimizer.step()             â”‚ â”‚
  â”‚    â”‚ critic_optimizer.step()            â”‚ â”‚
  â”‚    â”‚ â†‘ [MARL í—¤ë“œë§Œ ì—…ë°ì´íŠ¸]            â”‚ â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                                             â”‚
  â”‚    (Quality, Portfolio, Hedgingë„ ë™ì¼)   â”‚
  â”‚                                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚  50íšŒ ì—…ë°ì´íŠ¸ ì™„ë£Œ
        â–¼

  Result:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ â€¢ ê³µìœ  ì¸ì½”ë”: 11ê°œ ì‹œìŠ¤í…œ ê²½í—˜ìœ¼ë¡œ í•™ìŠµ    â”‚
  â”‚   - ìƒ˜í”Œ íš¨ìœ¨ 11ë°° í–¥ìƒ!                   â”‚
  â”‚   - Off-policy í•™ìŠµ ì •ë‹¹í™”                 â”‚
  â”‚                                             â”‚
  â”‚ â€¢ MARL í—¤ë“œ: ì—…ë°ì´íŠ¸ë¨                     â”‚
  â”‚   - Actor/Critic ê°œì„                       â”‚
  â”‚                                             â”‚
  â”‚ â€¢ EA ì‹œìŠ¤í…œ: ë³€í™” ì—†ìŒ                      â”‚
  â”‚   - ì¸ì½”ë” ê³µìœ ë¡œ ê°„ì ‘ í˜œíƒ ë°›ìŒ            â”‚
  â”‚   - ë‹¤ìŒ ì„¸ëŒ€ì—ì„œ GAë¡œ ì§„í™”                 â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Step 3: EA ì§„í™” (GA)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  GA Evolution (í—¤ë“œë§Œ)                     â”‚
  â”‚                                             â”‚
  â”‚  for child in new_generation:              â”‚
  â”‚                                             â”‚
  â”‚    # Crossover (í—¤ë“œë§Œ êµí™˜)               â”‚
  â”‚    child.value_head = parent1.value_head   â”‚
  â”‚    child.quality_head = parent2.quality... â”‚
  â”‚    ...                                      â”‚
  â”‚                                             â”‚
  â”‚    # Mutation (í—¤ë“œë§Œ ë³€ì´)                â”‚
  â”‚    if random() < 0.9:                      â”‚
  â”‚      mutate_head(child, prob=0.1)          â”‚
  â”‚                                             â”‚
  â”‚  âš ï¸ ì¸ì½”ë”ëŠ” ë³€ì´ ì•ˆ í•¨!                    â”‚
  â”‚     (ê³µìœ  ì¸ì½”ë”ëŠ” RLë¡œë§Œ í•™ìŠµ)             â”‚
  â”‚                                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Step 4: ë‹¤ìŒ ì„¸ëŒ€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  All Systems (EA + MARL):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ â€¢ ê³µìœ  ì¸ì½”ë” ì‚¬ìš© (ì—…ë°ì´íŠ¸ëœ ë²„ì „)        â”‚
  â”‚   - ë” ì¢‹ì€ feature extraction             â”‚
  â”‚   - 11ê°œ ì‹œìŠ¤í…œì˜ ì§‘ë‹¨ ì§€ì‹ ë°˜ì˜            â”‚
  â”‚                                             â”‚
  â”‚ â€¢ EA í—¤ë“œ: GAë¡œ ì§„í™”ë¨                      â”‚
  â”‚   - ë” ë‹¤ì–‘í•œ ì „ëµ íƒìƒ‰                     â”‚
  â”‚                                             â”‚
  â”‚ â€¢ MARL í—¤ë“œ: RLë¡œ í•™ìŠµë¨                    â”‚
  â”‚   - ë” ì •êµí•œ ì •ì±…                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ 6. ê³µìœ  ì¸ì½”ë” í•™ìŠµ ë©”ì»¤ë‹ˆì¦˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Selective Encoder Learning (ë¹„ëŒ€ì¹­ í•™ìŠµ)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì „ì²´ ì‹œìŠ¤í…œ (11ê°œ):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EA #1  â”‚ EA #2  â”‚  ...   â”‚ EA #10 â”‚ MARL   â”‚        â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â”‚
    â”‚        â”‚         â”‚       â”‚        â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
                      â”‚                                â”‚
                      â–¼                                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
         â”‚  Shared Replay Buffer    â”‚                 â”‚
         â”‚  (660ê°œ transition)      â”‚                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                      â”‚                                â”‚
                      â”‚  sample(256)                   â”‚
                      â–¼                                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
         â”‚       Batch (256)        â”‚                 â”‚
         â”‚  EA: ~233ê°œ (90%)        â”‚                 â”‚
         â”‚  MARL: ~23ê°œ (10%)       â”‚                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                      â”‚                                â”‚
                      â–¼                                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
         â”‚   MARLë§Œ í•™ìŠµ ì‹¤í–‰       â”‚                 â”‚
         â”‚                          â”‚                 â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                 â”‚
         â”‚  â”‚ Encoder Update     â”‚  â”‚                 â”‚
         â”‚  â”‚ (Global Optimizer) â”‚  â”‚                 â”‚
         â”‚  â”‚ LR = 3e-4         â”‚  â”‚                 â”‚
         â”‚  â”‚                    â”‚  â”‚                 â”‚
         â”‚  â”‚ - EA ê²½í—˜ í™œìš© âœ…  â”‚  â”‚                 â”‚
         â”‚  â”‚ - MARL ê²½í—˜ í™œìš© âœ…â”‚  â”‚                 â”‚
         â”‚  â”‚ - 64ê°œ ë°°ì¹˜ í•™ìŠµ    â”‚  â”‚                 â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                 â”‚
         â”‚                          â”‚                 â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                 â”‚
         â”‚  â”‚ Head Update        â”‚  â”‚                 â”‚
         â”‚  â”‚ (Local Optimizer)  â”‚  â”‚                 â”‚
         â”‚  â”‚                    â”‚  â”‚                 â”‚
         â”‚  â”‚ - MARL í—¤ë“œë§Œ âœ…   â”‚  â”‚                 â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                      â”‚                                â”‚
                      â–¼                                â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
         â”‚    ê²°ê³¼                   â”‚                 â”‚
         â”‚                          â”‚                 â”‚
         â”‚  â€¢ ê³µìœ  ì¸ì½”ë”:           â”‚                 â”‚
         â”‚    - 11ê°œ ì‹œìŠ¤í…œ ê²½í—˜ìœ¼ë¡œ  â”‚                 â”‚
         â”‚      feature í•™ìŠµ        â”‚                 â”‚
         â”‚    - ìƒ˜í”Œ íš¨ìœ¨ 11ë°° â†‘    â”‚                 â”‚
         â”‚                          â”‚                 â”‚
         â”‚  â€¢ MARL í—¤ë“œ: ì—…ë°ì´íŠ¸    â”‚                 â”‚
         â”‚  â€¢ EA í—¤ë“œ: ë³€í™” ì—†ìŒ     â”‚                 â”‚
         â”‚    (ë‹¤ìŒ GAì—ì„œ ì§„í™”)    â”‚                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚


ì¥ì :
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. ìƒ˜í”Œ íš¨ìœ¨ í­ë°œì  ì¦ê°€
   Before: MARLì´ ìì‹ ì˜ 60ê°œë§Œ í•™ìŠµ
   After:  MARLì´ ì „ì²´ 660ê°œ í•™ìŠµ (11ë°°!)

2. Off-policy í•™ìŠµ ì •ë‹¹í™”
   Before: EAì™€ MARLì´ ë‹¤ë¥¸ feature space
           â†’ EA ê²½í—˜ ì‚¬ìš© ì‹œ policy mismatch
   After:  ê°™ì€ ì¸ì½”ë” â†’ ê°™ì€ feature space
           â†’ EA ê²½í—˜ í™œìš© ê°€ëŠ¥!

3. ì§‘ë‹¨ ì§€ì„± íš¨ê³¼
   EA #1: "ì‚¼ì„±ì „ì PER 10 â†’ ì¢‹ìŒ" ë°œê²¬
   EA #5: "í˜„ëŒ€ì°¨ PER 15 â†’ ë‚˜ì¨" ë°œê²¬
   â†’ ì¸ì½”ë”: "PER ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ" í•™ìŠµ
   â†’ ëª¨ë“  ì‹œìŠ¤í…œì´ ì´ ì§€ì‹ í™œìš©!

4. EAë„ ê°„ì ‘ í˜œíƒ
   EAëŠ” RL ì•ˆ í•˜ì§€ë§Œ, ì—…ë°ì´íŠ¸ëœ ì¸ì½”ë” ì‚¬ìš©
   â†’ ë” ì¢‹ì€ featureë¡œ GA ì§„í™”
```

---

## ğŸ§¬ 7. Sparse Mutation (RACE ìŠ¤íƒ€ì¼)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Sparse Mutation Mechanism                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Before (ê³¼ë„í•œ ë³€ì´):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  for child in children:
    if random() < 0.9:  # 90% ìì‹ ë³€ì´
      for param in child.parameters():
        if random() < 0.9:  # 90% íŒŒë¼ë¯¸í„° ë³€ì´
          param += noise
  
  ì‹¤ì œ ë³€ì´ìœ¨ = 0.9 Ã— 0.9 = 81%
  
  ë¬¸ì œ:
  - ë„ˆë¬´ ê³µê²©ì 
  - í•™ìŠµëœ íŒ¨í„´ íŒŒê´´
  - íƒìƒ‰ > í™œìš© (ë¶ˆê· í˜•)


After (Sparse Mutation):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  for child in children:
    if random() < 0.9:  # 90% ìì‹ ë³€ì´ (CHILD_MUTATION_PROB)
      for param in child.parameters():
        if random() < 0.1:  # 10% íŒŒë¼ë¯¸í„°ë§Œ! (PARAM_MUTATION_PROB)
          param += noise * 0.05
  
  ì‹¤ì œ ë³€ì´ìœ¨ = 0.9 Ã— 0.1 = 9%
  
  íš¨ê³¼:
  - ì ì ˆí•œ íƒìƒ‰
  - íŒ¨í„´ ë³´ì¡´
  - íƒìƒ‰ â‰ˆ í™œìš© (ê· í˜•)


ì‹œê°í™”:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Actor Head íŒŒë¼ë¯¸í„° (1000ê°œ):
  
  Before (81% ë³€ì´):
  [âœ— âœ— âœ— âœ— âœ— âœ— âœ— âœ— âœ“ âœ— âœ— âœ— âœ— âœ— âœ— âœ— âœ— âœ— âœ— ...]
   â””â”€ âœ— = ë³€ì´ë¨ (810ê°œ)
   â””â”€ âœ“ = ë³´ì¡´ë¨ (190ê°œ)
  
  After (9% ë³€ì´):
  [âœ“ âœ“ âœ“ âœ— âœ“ âœ“ âœ“ âœ“ âœ“ âœ“ âœ“ âœ“ âœ“ âœ— âœ“ âœ“ âœ“ âœ“ âœ“ ...]
   â””â”€ âœ— = ë³€ì´ë¨ (90ê°œ)
   â””â”€ âœ“ = ë³´ì¡´ë¨ (910ê°œ)


RACE ë…¼ë¬¸ê³¼ ë¹„êµ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  RACE (src/learners/coma_learner.py):
  
    if np.random.rand() < 0.9:
        mutate_actor(child, frac=0.1)
    
    â†’ ì‹¤ì œ ë³€ì´ìœ¨ = 9%
  
  ìš°ë¦¬ êµ¬í˜„:
  
    if np.random.rand() < config.CHILD_MUTATION_PROB:  # 0.9
        mutate(child, prob=config.PARAM_MUTATION_PROB)  # 0.1
    
    â†’ ì‹¤ì œ ë³€ì´ìœ¨ = 9% âœ… ë™ì¼!
```

---

## ğŸ¯ 8. ì¡°ê±´ë¶€ Injection (ì„±ëŠ¥ ê¸°ë°˜)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Conditional Injection Logic                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Before (ë¬´ì¡°ê±´ ì£¼ì…):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  EA Fitness: [0.58, 0.46, 0.74, -0.42, 0.49, ...]
  MARL Fitness: -0.84  âŒ (worst EAë³´ë‹¤ ë‚®ìŒ!)
  
  worst_idx = 3  # EA #4 (-0.42)
  population[3] = marl.clone()  â† ë¬´ì¡°ê±´ ì£¼ì…!
  
  ë¬¸ì œ:
  - ë‚˜ìœ MARLì´ ì¢‹ì€ EA ëŒ€ì²´
  - Population í‡´í™”
  - í‰ê·  fitness í•˜ë½


After (ì¡°ê±´ë¶€ ì£¼ì…):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  EA Fitness: [0.58, 0.46, 0.74, -0.42, 0.49, ...]
  MARL Fitness: -0.84
  
  worst_idx = 3  # EA #4 (-0.42)
  
  if marl_fitness > ea_fitness[worst_idx]:  # -0.84 > -0.42?
      # False!
      print("[SKIP] MARLì´ worst EAë³´ë‹¤ ë‚®ìŒ")
  else:
      population[worst_idx] = marl.clone()
      print("[OK] Injection ì™„ë£Œ")
  
  íš¨ê³¼:
  - Population í’ˆì§ˆ ë³´ì¥
  - MARLì´ ì¶©ë¶„íˆ í•™ìŠµ í›„ì—ë§Œ ì£¼ì…
  - í‰ê·  fitness ìœ ì§€/í–¥ìƒ


ì„±ê³µ ì¼€ì´ìŠ¤:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  ì„¸ëŒ€ 5:
    EA Fitness: [0.58, 0.46, 0.74, -0.42, 0.49, ...]
    MARL Fitness: 0.85  âœ… (very good!)
    
    worst_idx = 3  # EA #4 (-0.42)
    
    if 0.85 > -0.42:  # True!
      population[3] = marl.clone()
      print("[OK] Injection ì™„ë£Œ")
    
    Result:
      Before: [0.58, 0.46, 0.74, -0.42, 0.49, ...]
      After:  [0.58, 0.46, 0.74,  0.85, 0.49, ...]
                                   â†‘ ê°œì„ !


ë¡œê·¸ ì˜ˆì‹œ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  [3/4] Injection: MARL íŒ€ì„ Populationì— ì£¼ì…
  MARL íŒ€ Fitness: 0.8540
  Worst íŒ€ (EA #4): 0.5226
  [OK] Injection ì™„ë£Œ (MARL > Worst)
  
  ë˜ëŠ”:
  
  [3/4] Injection ê²€í† 
  MARL íŒ€ Fitness: -0.8440
  Worst íŒ€ (EA #4): -0.4226
  [SKIP] MARLì´ worst EAë³´ë‹¤ ë‚®ìŒ (ì£¼ì… ì•ˆ í•¨)
```

---

## ğŸ“ˆ 9. ì „ì²´ ì‹œìŠ¤í…œ í•™ìŠµ ê³¡ì„ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Training Progress (2021-2023)                   â”‚
â”‚                     Rolling Window (12 ì„¸ëŒ€)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Generation 1 (2021 Q1):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  
  ì´ˆê¸° Population (ëœë¤ ì´ˆê¸°í™”)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ EA #1:   fitness = 0.58             â”‚
  â”‚ EA #2:   fitness = 0.46             â”‚
  â”‚ EA #3:   fitness = 0.74             â”‚
  â”‚ EA #4:   fitness = -0.42            â”‚
  â”‚ ...                                 â”‚
  â”‚ EA #10:  fitness = 1.72 â˜…           â”‚
  â”‚ MARL:    fitness = -0.84            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
  EA í‰ê· : 0.53
  EA ìµœê³ : 1.72
  MARL: -0.84 (ì•„ì§ í•™ìŠµ ë¶€ì¡±)


Generation 6 (2022 Q2):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  
  GA + RL í•™ìŠµ í›„
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ EA #1:   fitness = 0.95             â”‚
  â”‚ EA #2:   fitness = 0.82             â”‚
  â”‚ EA #3:   fitness = 1.15             â”‚
  â”‚ EA #4:   fitness = 0.68             â”‚
  â”‚ ...                                 â”‚
  â”‚ EA #10:  fitness = 2.34 â˜…           â”‚
  â”‚ MARL:    fitness = 1.05 âœ…          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
  EA í‰ê· : 1.12 (+0.59)
  EA ìµœê³ : 2.34 (+0.62)
  MARL: 1.05 (EA í‰ê·  ê·¼ì ‘!)


Generation 12 (2023 Q4):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  
  ìˆ˜ë ´
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ EA #1:   fitness = 1.45             â”‚
  â”‚ EA #2:   fitness = 1.28             â”‚
  â”‚ EA #3:   fitness = 1.67             â”‚
  â”‚ EA #4:   fitness = 1.19             â”‚
  â”‚ ...                                 â”‚
  â”‚ EA #10:  fitness = 3.85 â˜…           â”‚
  â”‚ MARL:    fitness = 1.52 âœ…          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
  EA í‰ê· : 1.58 (+1.05 from Gen1)
  EA ìµœê³ : 3.85 (+2.13 from Gen1)
  MARL: 1.52 (EA í‰ê·  ì´ìƒ!)
  
  Final Best System (EA #10):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Sharpe Ratio:     3.85             â”‚
  â”‚ Period Return:    +12.3%           â”‚
  â”‚ Max Drawdown:     -5.2%            â”‚
  â”‚ Calmar Ratio:     2.37             â”‚
  â”‚ Win Rate:         62%              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


í•™ìŠµ íš¨ê³¼ ë¶„ì„:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  ê³µìœ  ì¸ì½”ë” íš¨ê³¼:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ â€¢ ìƒ˜í”Œ íš¨ìœ¨ 11ë°° í–¥ìƒ               â”‚
  â”‚ â€¢ Off-policy í•™ìŠµ ì •ë‹¹í™”            â”‚
  â”‚ â€¢ ì§‘ë‹¨ ì§€ì‹ ì¶•ì                     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
  Sparse Mutation íš¨ê³¼:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ â€¢ Elite íŒ¨í„´ ë³´ì¡´                   â”‚
  â”‚ â€¢ ì•ˆì •ì  ìˆ˜ë ´                       â”‚
  â”‚ â€¢ íƒìƒ‰/í™œìš© ê· í˜•                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
  ì¡°ê±´ë¶€ Injection íš¨ê³¼:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ â€¢ Population í’ˆì§ˆ ìœ ì§€              â”‚
  â”‚ â€¢ MARL ì ì§„ì  ê°œì„                   â”‚
  â”‚ â€¢ ìµœì¢…ì ìœ¼ë¡œ EA í‰ê·  ì´ìƒ ë‹¬ì„±      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ 10. ìµœì¢… ì‹œìŠ¤í…œ ìš”ì•½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  QuantMARLGA System Summary                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Architecture:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  
  â€¢ Population: 10 EA + 1 MARL
  â€¢ Agents: 4 per system (Value, Quality, Portfolio, Hedging)
  â€¢ Total Agents: 44 (11 systems Ã— 4 agents)
  â€¢ Shared Encoders: 4 (type-specific)
  â€¢ Architecture: ë³‘ë ¬ + ìœµí•© (Parallel + Fusion)


Data:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  
  â€¢ Stocks: 30 (KOSPI top)
  â€¢ Training: 2021-2023 (12 generations, rolling window)
  â€¢ Testing: 2024-H1 (out-of-sample)
  â€¢ Features:
    - Price data: Real (FinanceDataReader)
    - PER/PBR: Real (pykrx)
    - ROE/Debt: Real + Estimated (OpenDart)
    - Technicals: Calculated (volatility, beta, etc)


Learning:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  
  â€¢ GA (EA Population):
    - Selection: Tournament (k=3)
    - Crossover: Agent-level
    - Mutation: Sparse (9% effective rate)
    - Elitism: Top 30%
  
  â€¢ RL (MARL Team):
    - Algorithm: Actor-Critic
    - Shared Buffer: 660 experiences per generation
    - Updates: 200 per generation (50â†’200: RACE-proportional)
    - Batch Size: 64 (128â†’64: ê³¼ì í•© ë°©ì§€)
    - Learning Rates:
      - Actor: 3e-4
      - Critic: 5e-4 (1e-3â†’5e-4: ì•ˆì •ì„±)
      - Encoder: 3e-4 (ëª…ì‹œì  ê´€ë¦¬)
    - Encoder Learning: Selective (MARL only)
  
  â€¢ Hybrid:
    - Injection: Conditional (if MARL > worst EA)
    - Encoder: Shared by type, learned by RL
    - Head: Independent, evolved by GA (EA) or learned by RL (MARL)


Optimization:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  
  â€¢ Rolling Window: Load once, slice per generation (99% faster)
  â€¢ GPU: CUDA + Mixed Precision (FP16)
  â€¢ Initialization: Orthogonal
  â€¢ Gradient: Clipping (max_norm=10)
  â€¢ Target Network: Soft update (Ï„=0.005)


Performance:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  
  â€¢ Training Time: 30-40 mins (12 generations, GPU, 200 updates/gen)
  â€¢ Memory: ~3GB (GPU, batch_size=64)
  â€¢ Sample Efficiency: 11Ã— (shared encoder)
  â€¢ Learning Efficiency: 4Ã— (200 vs 50 updates)
  â€¢ Convergence: Stable (sparse mutation + balanced LR)


Implementation Status:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  
  âœ… Data Pipeline (100%)
  âœ… Multi-Agent System (100%)
  âœ… Backtest Environment (100%)
  âœ… GA Evolution (100%)
  âœ… RL Learning (100%)
  âœ… Shared Encoder (100%)
  âœ… Sparse Mutation (100%)
  âœ… Conditional Injection (100%)
  âœ… Rolling Window (100%)
  âœ… GPU Optimization (100%)
  âœ… Hyperparameter Optimization (100%)
    - RL_UPDATES: 50â†’200 (RACE-proportional)
    - BATCH_SIZE: 128â†’64 (ê³¼ì í•© ë°©ì§€)
    - LEARNING_RATE_CRITIC: 1e-3â†’5e-4 (ì•ˆì •ì„±)
    - ENCODER_LEARNING_RATE: 3e-4 (ëª…ì‹œ)
  
  â³ Colab Training (Pending)
  â³ Out-of-sample Test (Pending)
  â³ Performance Analysis (Pending)
```

---

## ğŸš€ Quick Start

### 1. ì¢…ëª© Universe ì„ ì • (í•„ìˆ˜!)

ì „ì²´ ê¸°ê°„(2021-2024)ì— ê²°ì¸¡ì¹˜ ì—†ëŠ” ìƒìœ„ 30ê°œ ì¢…ëª©ì„ ì„ ì •í•©ë‹ˆë‹¤:

```bash
python trading_marl_ga/select_universe.py
```

**ì¶œë ¥:**
- `data/selected_tickers.pkl` - ì„ ì •ëœ ì¢…ëª© ë¦¬ìŠ¤íŠ¸
- í•™ìŠµê³¼ í…ŒìŠ¤íŠ¸ì—ì„œ ë™ì¼í•œ ì¢…ëª© ì‚¬ìš© â†’ **ì¼ê´€ì„± ë³´ì¥**

### 2. í•™ìŠµ (2021-2023)

ì„ ì •ëœ ì¢…ëª©ìœ¼ë¡œ Rolling Window í•™ìŠµ:

```bash
python trading_marl_ga/train.py
```

**ì €ì¥:**
- `models/best_system/` - ìµœê³  ì„±ëŠ¥ ëª¨ë¸
- `models/metadata.pkl` - í•™ìŠµ ì •ë³´ + ì¢…ëª© ë¦¬ìŠ¤íŠ¸

### 3. í…ŒìŠ¤íŠ¸ (2024)

í•™ìŠµê³¼ ë™ì¼í•œ ì¢…ëª©ìœ¼ë¡œ Out-of-sample í…ŒìŠ¤íŠ¸:

```bash
python trading_marl_ga/test.py
```

**ìë™ìœ¼ë¡œ:**
- `metadata.pkl`ì—ì„œ í•™ìŠµ ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
- ê°™ì€ ì¢…ëª©ìœ¼ë¡œ 2024 ë°ì´í„° ë°±í…ŒìŠ¤íŠ¸
- ë²¤ì¹˜ë§ˆí¬ ë¹„êµ (Buy & Hold, Random, KOSPI)

### âš ï¸ ì¤‘ìš”: ì¢…ëª© ì¼ê´€ì„±

```python
# âŒ ì˜ëª»ëœ ë°©ë²• (ì´ì „)
train.py:  2021-2023ì—ì„œ ìƒìœ„ 30ê°œ ì„ ì • â†’ [A, B, C, ...]
test.py:   2024ì—ì„œ ìƒìœ„ 30ê°œ ì„ ì • â†’ [A, D, E, ...]  # ì¢…ëª© ë‹¤ë¦„!

# âœ… ì˜¬ë°”ë¥¸ ë°©ë²• (í˜„ì¬)
select_universe.py:  2021-2024 ì „ì²´ì—ì„œ 30ê°œ ì„ ì • â†’ [A, B, C, ...]
train.py:            ê°™ì€ 30ê°œ ì‚¬ìš© (2021-2023 ë°ì´í„°)
test.py:             ê°™ì€ 30ê°œ ì‚¬ìš© (2024 ë°ì´í„°)
```

**ì¥ì :**
- âœ… ìƒì¡´ í¸í–¥ ì œê±° (ì „ì²´ ê¸°ê°„ ìƒì¡´ ì¢…ëª©ë§Œ)
- âœ… í•™ìŠµ-í…ŒìŠ¤íŠ¸ ì¼ê´€ì„± ë³´ì¥
- âœ… ì¬í˜„ ê°€ëŠ¥í•œ ì‹¤í—˜

---

**ë¬¸ì„œ ìƒì„±**: 2025-11-23  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-11-24 (ì¢…ëª© ì„ ì • í”„ë¡œì„¸ìŠ¤ ì¶”ê°€)  
**ì‘ì„±ì**: AI Assistant

